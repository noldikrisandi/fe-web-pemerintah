import{r,j as e,B as u,S as P,V as $,T as t,a as J,m as g,M as C,z as _,A as M,C as E,a3 as O,D as w,G as d,a4 as K,b as h}from"./index-CySiJ9US.js";import{H as U}from"./chunk-3ASUQ6PA-DGUpMnc4.js";import{T as V}from"./chunk-4IH3O7BJ-Q8nFKEXr.js";const Q=()=>{const[p,x]=r.useState([]),[z,j]=r.useState(!0),[f,b]=r.useState({isOpen:!1,url:""}),[c,S]=r.useState({isOpen:!1,aspiration:null}),[n,k]=r.useState({jenis:"",kecamatan:"",desa:"",keterangan:"",url_foto:"",url_aspirasi:""}),[D,v]=r.useState(0),i=localStorage.getItem("id");r.useEffect(()=>{(async()=>{if(!i){j(!1);return}try{const s=await h.get(`/aspirations/user/${i}`),o={"":1,Menunggu:2,Diproses:3,Pending:4,Selesai:5,Ditolak:6};let m=s.data.data.sort((W,H)=>(o[W.status]||99)-(o[H.status]||99));x(m);const A=await h.get(`/aspirations/count/${i}`);console.log("Jumlah Aspirasi Response:",A.data),v(A.data.total_aspirations)}catch(s){console.error("Gagal mengambil data:",s)}finally{j(!1)}})()},[i]);const I=a=>{b({isOpen:!0,url:a})},B=()=>{b({isOpen:!1,url:""})},R=a=>{k({jenis:a.jenis,kecamatan:a.kecamatan,desa:a.desa,keterangan:a.keterangan,url_foto:a.url_foto||"",url_aspirasi:a.url_proposal||""}),S({isOpen:!0,aspiration:a})},y=()=>{S({isOpen:!1,aspiration:null})},l=a=>{const{name:s,value:o}=a.target;k(m=>({...m,[s]:o}))},G=async()=>{try{const a={...c.aspiration,...n};await h.put(`/aspirations/${c.aspiration.id}`,a),x(s=>s.map(o=>o.id===c.aspiration.id?a:o)),y()}catch(a){console.error("Gagal mengedit aspirasi:",a)}},L=a=>{switch(a){case"Selesai":return"green.400";case"Diproses":return"blue.400";case"Ditolak":return"red.400";case"Pending":return"yellow.400";default:return"gray.300"}},T=a=>!["Selesai","Ditolak","Diproses"].includes(a);return z?e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh",children:e.jsx(P,{size:"xl"})}):e.jsxs(u,{p:5,children:[e.jsx(u,{p:5,boxShadow:"md",borderRadius:"md",bg:"white",mb:7,children:e.jsxs($,{spacing:5,mb:6,align:"center",children:[e.jsx(t,{fontSize:"2xl",fontWeight:"bold",color:"teal.500",children:"Aspirasi Saya"}),e.jsx(t,{fontSize:"md",color:"gray.600",textAlign:"center",children:"Silakan kirimkan aspirasi Anda terkait masalah yang ada di lingkungan Anda."}),e.jsxs(t,{fontSize:"md",color:"gray.700",textAlign:"center",children:[" Anda telah mengirim ",D," aspirasi dalam 7 hari ini"]})]})}),i?p.length===0?e.jsx(t,{textAlign:"center",fontSize:"lg",color:"gray.500",children:"Belum ada aspirasi yang diajukan."}):e.jsx(J,{columns:{base:1,sm:2,md:3,lg:4},spacing:6,children:p.map(a=>e.jsxs(u,{p:5,borderWidth:2,borderRadius:"lg",borderColor:L(a.status),boxShadow:"md",_hover:{boxShadow:"xl",transform:"scale(1.05)",transition:"all 0.3s ease"},bg:"white",transition:"all 0.3s ease",children:[e.jsxs(t,{fontWeight:"bold",fontSize:"lg",color:"teal.500",mb:2,children:["Token: ",a.id]}),e.jsx(t,{fontWeight:"semibold",color:"gray.700",mb:2,children:a.jenis}),e.jsx(t,{color:"gray.600",mb:2,children:a.keterangan}),e.jsxs(t,{color:"gray.500",fontStyle:"italic",mb:2,children:[a.desa,", ",a.kecamatan]}),e.jsxs(t,{color:"gray.600",fontWeight:"bold",mb:2,children:["Status: ",a.status||"Tanpa Status"]}),a.keterangan_status&&e.jsx(t,{color:"gray.600",mb:2,children:a.keterangan_status}),e.jsxs(U,{spacing:2,mt:4,children:[a.url_foto&&e.jsx(g,{colorScheme:"blue",size:"sm",onClick:()=>I(a.url_foto),children:"Lihat Gambar"}),a.url_proposal&&e.jsx(g,{colorScheme:"green",size:"sm",as:"a",href:a.url_proposal,target:"_blank",rel:"noopener noreferrer",children:"Lihat Proposal"}),T(a.status)&&e.jsx(g,{colorScheme:"orange",size:"sm",onClick:()=>R(a),children:"Edit"})]})]},a.id))}):e.jsx(t,{textAlign:"center",fontSize:"lg",color:"red.500",children:"Anda belum login. Silakan login terlebih dahulu."}),e.jsxs(C,{isOpen:c.isOpen,onClose:y,children:[e.jsx(_,{}),e.jsxs(M,{children:[e.jsx(E,{children:"Edit Aspirasi"}),e.jsx(O,{}),e.jsxs(w,{children:[e.jsx(d,{name:"jenis",value:n.jenis,onChange:l,placeholder:"Jenis Aspirasi",mb:3}),e.jsx(d,{name:"kecamatan",value:n.kecamatan,onChange:l,placeholder:"Kecamatan",mb:3}),e.jsx(d,{name:"desa",value:n.desa,onChange:l,placeholder:"Desa",mb:3}),e.jsx(V,{name:"keterangan",value:n.keterangan,onChange:l,placeholder:"Keterangan",mb:3}),e.jsx(d,{name:"url_foto",value:n.url_foto,onChange:l,placeholder:"URL Foto",mb:3}),e.jsx(d,{name:"url_aspirasi",value:n.url_aspirasi,onChange:l,placeholder:"URL Aspirasi",mb:3}),e.jsx(g,{colorScheme:"blue",onClick:G,children:"Simpan"})]})]})]}),e.jsxs(C,{isOpen:f.isOpen,onClose:B,children:[e.jsx(_,{}),e.jsxs(M,{children:[e.jsx(E,{children:"Lihat Gambar"}),e.jsx(O,{}),e.jsx(w,{children:e.jsx(K,{src:f.url,alt:"Aspirasi Image"})})]})]})]})};export{Q as default};
